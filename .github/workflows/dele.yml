name: 删除中间文件

on:
  workflow_dispatch:  # 手动触发

jobs:
  delete_workflows:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Delete hash-chunk and scan_chunk workflow files
        run: |
          FILES_COUNT=$(find .github/workflows -type f \( -name "*hash-chunk*.yml" -o -name "*scan_chunk*.yml" \) | wc -l)

          if [ "$FILES_COUNT" -eq 0 ]; then
            echo "No matching workflow files found."
            exit 0
          fi

          echo "Deleting files:"
          find .github/workflows -type f \( -name "*hash-chunk*.yml" -o -name "*scan_chunk*.yml" \) -print

          find .github/workflows -type f \( -name "*hash-chunk*.yml" -o -name "*scan_chunk*.yml" \) -print0 | xargs -0 git rm

          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git commit -m "Delete hash-chunk and scan_chunk workflow files"
          git push
